<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor Caixa D'√Ågua - Dashboard</title>
    <link rel="icon" type="image/png" href="img1.png">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Monitor Caixa D'√Ågua <img src="img1.png" alt="Caixa D'√Ågua" class="water-tank-icon"></h1>
            <div class="status-card">
                <div class="current-level">
                    <span class="level-value" id="currentLevel">--</span>
                    <span class="level-unit">%</span>
                </div>
                <div class="last-update" id="lastUpdate">Carregando...</div>
            </div>
        </header>

        <!-- Card de Controle da Bomba (oculto por padr√£o) -->
        <section class="pump-card" id="pumpCard" style="display: none;">
            <div class="pump-card-content">
                <h3><img src="water-pump.png" alt="Bomba" class="pump-icon"> Controle da Bomba</h3>
                
                <div class="pump-status">
                    <div class="status-item">
                        <span class="status-label">Status:</span>
                        <span class="status-value" id="pumpStatus">Carregando...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">√öltima ativa√ß√£o:</span>
                        <span class="status-value" id="pumpLastActivation">--</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Dura√ß√£o:</span>
                        <span class="status-value" id="pumpDuration">--</span>
                    </div>
                </div>
                
                <div class="pump-controls">
                    <button id="pumpButton" class="pump-btn">
                        <img src="water-pump.png" alt="Bomba" class="pump-icon-btn"> Ligar Bomba
                    </button>
                </div>
            </div>
        </section>

        <main>
            <!-- Controles do Gr√°fico -->
            <section class="controls">
                <div class="time-selector">
                    <button class="time-btn active" data-period="24h">24 Horas</button>
                    <button class="time-btn" data-period="7d">7 Dias</button>
                    <button class="time-btn" data-period="30d">30 Dias</button>
                    <button class="time-btn" data-period="all">Todos</button>
                </div>
                
                <div class="chart-options">
                    <label>
                        <input type="checkbox" id="showCompesaEvents" checked>
                        Mostrar dados da COMPESA
                    </label>
                    <label>
                        <input type="checkbox" id="showPumpEvents" checked>
                        Mostrar acionamentos da bomba
                    </label>
                    <label>
                        <input type="checkbox" id="showTrendLine">
                        Linha de tend√™ncia
                    </label>
                    <label>
                        <input type="checkbox" id="autoUpdateEnabled" checked>
                        Atualiza√ß√£o autom√°tica
                    </label>
                </div>
            </section>

            <!-- Gr√°fico Principal -->
            <section class="chart-section">
                <div class="chart-header">
                    <h2>Gr√°fico do N√≠vel da Caixa D'√Ågua</h2>
                    <div class="zoom-controls">
                        <button id="zoomIn" class="zoom-btn" title="Zoom In">üîç+</button>
                        <button id="zoomOut" class="zoom-btn" title="Zoom Out">üîç-</button>
                        <button id="resetZoom" class="zoom-btn" title="Reset Zoom">üîÑ</button>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="waterChart"></canvas>
                </div>
                <div class="chart-instructions">
                    <p><strong>üí° Dica:</strong> Use os bot√µes acima ou gestos para zoom. <span class="desktop-only">Desktop: Shift+scroll para zoom, Shift+arrastar para navegar.</span> <span class="mobile-only">Mobile: belisque para zoom, arraste para navegar.</span></p>
                    <p id="adminChartInstructions" style="display: none; color: #e74c3c; font-weight: bold; margin-top: 8px;">üîß <strong>Modo Admin:</strong> Clique em qualquer ponto do gr√°fico para marcar chegada da COMPESA</p>
                </div>
                
                <!-- Card de marca√ß√£o da COMPESA -->
                <div class="compesa-mark-card" id="compesaMarkCard" style="display: none;">
                    <div class="mark-card-content">
                        <div class="mark-info">
                            <h4>üìç Ponto Selecionado</h4>
                            <div class="mark-details">
                                <div class="mark-detail-item">
                                    <span class="detail-label">üìÖ Data/Hora:</span>
                                    <span class="detail-value" id="markDateTime">--</span>
                                </div>
                                <div class="mark-detail-item">
                                    <span class="detail-label">üíß N√≠vel:</span>
                                    <span class="detail-value" id="markLevel">--%</span>
                                </div>
                                <div class="mark-detail-item">
                                    <span class="detail-label">üìà Aumento:</span>
                                    <span class="detail-value" id="markIncrease">+0.0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="mark-actions">
                            <button id="confirmCompesaMark" class="confirm-mark-btn">
                                üö∞ Marcar como Chegada da COMPESA
                            </button>
                            <button id="cancelCompesaMark" class="cancel-mark-btn">
                                ‚ùå Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="loading" id="chartLoading">
                    <div class="spinner"></div>
                    <p>Carregando dados...</p>
                </div>
            </section>

            <!-- Estat√≠sticas -->
            <section class="stats">
                <div class="stat-card">
                    <h3>√öltima vez que chegou √°gua da COMPESA</h3>
                    <p id="lastCompesa">--</p>
                </div>
                <div class="stat-card">
                    <h3>Pr√≥xima vez que chegar√° √°gua da COMPESA</h3>
                    <p id="nextCompesa">--</p>
                </div>
                <div class="stat-card">
                    <h3>N√≠vel M√©dio (7d)</h3>
                    <p id="avgLevel">--%</p>
                </div>
            </section>

            <!-- Hist√≥rico de Eventos -->
            <section class="events-section">
                <h2>üìã Hist√≥rico da COMPESA</h2>
                <div class="events-list" id="eventsList">
                    <div class="loading">Carregando eventos...</div>
                </div>
            </section>
        </main>

        <footer>
            <p>üîÑ Atualiza√ß√£o autom√°tica a cada 30 segundos</p>
            <p>üìä Dados em tempo real do ESP8266</p>
        </footer>
    </div>

    <!-- Dialog de confirma√ß√£o da bomba -->
    <div class="pump-dialog-overlay" id="pumpDialogOverlay" style="display: none;">
        <div class="pump-dialog">
            <div class="pump-dialog-header">
                <h3 id="pumpDialogTitle">Confirmar A√ß√£o</h3>
            </div>
            <div class="pump-dialog-content">
                <div class="pump-dialog-icon" id="pumpDialogIcon">üíß</div>
                <p id="pumpDialogMessage">Deseja realmente executar esta a√ß√£o?</p>
            </div>
            <div class="pump-dialog-actions">
                <button id="pumpDialogCancel" class="pump-dialog-btn pump-dialog-btn-cancel">
                    ‚ùå Cancelar
                </button>
                <button id="pumpDialogConfirm" class="pump-dialog-btn pump-dialog-btn-confirm">
                    ‚úÖ Confirmar
                </button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="firebase-service.js"></script>
    <script src="chart-manager.js"></script>
    <script src="app.js"></script>
</body>
</html>
